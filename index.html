<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>2026í•™ë…„ë„ í•™ì‚¬ì¼ì •</title>
  <style>
    :root{
      /* White mode */
      --bg:#f6f8fb;
      --card:#ffffff;
      --muted:#5b677a;
      --text:#111827;
      --line:#d8dee9;
      --accent:#2563eb;
      --accent2:#16a34a;
      --warn:#d97706;
      --bad:#dc2626;
      --chip:#f1f5f9;
      --shadow: 0 10px 30px rgba(15, 23, 42, .08);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 15% 10%, #ffffff 0%, var(--bg) 60%);
      color:var(--text);
    }
    header{
      position:sticky; top:0; z-index:10;
      background: rgba(246,248,251,.85);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--line);
    }
    .wrap{max-width:1200px; margin:0 auto; padding:16px;}
    .title{display:flex; align-items:flex-end; justify-content:space-between; gap:12px; flex-wrap:wrap;}
    h1{margin:0; font-size:20px; letter-spacing:-.3px;}
    .sub{margin:0; color:var(--muted); font-size:13px}

    .toolbar{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; align-items:center; justify-content:space-between;}
    .controls{display:flex; gap:10px; flex-wrap:wrap; align-items:center}

    .btn{
      border:1px solid var(--line);
      background: rgba(255,255,255,.9);
      color:var(--text);
      padding:10px 12px; border-radius:12px; cursor:pointer;
      display:inline-flex; gap:8px; align-items:center;
      transition:.15s transform, .15s opacity, .15s box-shadow;
      user-select:none;
      box-shadow: 0 1px 0 rgba(15,23,42,.03);
    }
    .btn:hover{opacity:.95; box-shadow: 0 6px 18px rgba(15,23,42,.08)}
    .btn:active{transform: translateY(1px)}
    .btn.primary{border-color: rgba(37,99,235,.35); box-shadow: 0 0 0 3px rgba(37,99,235,.12) inset;}
    .btn.good{border-color: rgba(22,163,74,.35)}
    .btn.bad{border-color: rgba(220,38,38,.35)}
    .btn.small{padding:8px 10px; border-radius:10px; font-size:13px}
    .btn.link{
      border:0;
      background: transparent;
      box-shadow:none;
      padding:0;
      color: var(--accent);
      font-size:12px;
    }
    .btn.link:hover{box-shadow:none; text-decoration: underline}

    .input, select, textarea{
      border:1px solid var(--line);
      background: rgba(255,255,255,.95);
      color:var(--text);
      padding:10px 12px; border-radius:12px;
      outline:none;
      box-shadow: 0 1px 0 rgba(15,23,42,.03);
    }
    textarea{min-height:92px; resize:vertical}
    .input::placeholder{color:#94a3b8}

    main .grid{display:grid; grid-template-columns: 1.1fr .9fr; gap:14px; padding:16px;}
    @media (max-width: 980px){ main .grid{grid-template-columns:1fr} }

    .card{
      background: var(--card);
      border:1px solid var(--line);
      border-radius:18px;
      overflow:hidden;
      box-shadow: var(--shadow);
    }
    .card h2{margin:0; font-size:15px; padding:14px 14px 0 14px; letter-spacing:-.2px;}
    .card .hint{padding:6px 14px 12px 14px; margin:0; color:var(--muted); font-size:12px}

    .monthbar{
      display:flex; justify-content:space-between; align-items:center; gap:10px; padding:12px 14px;
      border-bottom:1px solid var(--line);
      background: #fafbff;
    }
    .monthbar .m{font-weight:700; letter-spacing:-.2px}

    .chips{display:flex; gap:8px; flex-wrap:wrap; padding:0 14px 14px}
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      background: var(--chip);
      border:1px solid var(--line);
      color: var(--muted);
      padding:8px 10px; border-radius:999px; font-size:12px;
      cursor:pointer;
    }
    .chip.active{color:var(--text); border-color: rgba(37,99,235,.35); background: rgba(37,99,235,.10)}
    .chip b{color:var(--text); font-weight:600}

    .calendar{padding:14px}
    .cal-head{display:grid; grid-template-columns: repeat(7, 1fr); gap:8px; padding:0 0 10px 0; color:var(--muted); font-size:12px}
    .cal-grid{display:grid; grid-template-columns: repeat(7, 1fr); gap:8px}

    .day{
      min-height:92px;
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px;
      background: #ffffff;
      display:flex; flex-direction:column; gap:8px;
    }
    .day.muted{opacity:.45}
    .dnum{font-size:12px; color:var(--muted); display:flex; justify-content:space-between; gap:8px}

    .pill{
      display:inline-flex; align-items:center; gap:6px;
      font-size:11px; padding:6px 8px; border-radius:999px;
      border:1px solid var(--line);
      background: #f8fafc;
      color: var(--text);
      overflow:hidden; white-space:nowrap; text-overflow:ellipsis;
    }
    .pill .dot{width:8px; height:8px; border-radius:50%}
    .pill.cat-í•™ì‚¬ .dot{background: var(--accent)}
    .pill.cat-ìˆ˜ì—… .dot{background: var(--accent2)}
    .pill.cat-ì‹œí—˜ .dot{background: var(--warn)}
    .pill.cat-íœ´ì¼ .dot{background: var(--bad)}

    .list{padding:14px; display:flex; flex-direction:column; gap:10px}
    .item{
      border:1px solid var(--line);
      border-radius:16px;
      padding:12px;
      background: #ffffff;
      display:flex; gap:12px; align-items:flex-start; justify-content:space-between;
    }
    .item .left{min-width:0}
    .item .date{font-weight:700; letter-spacing:-.2px}
    .item .meta{color:var(--muted); font-size:12px; margin-top:4px}
    .item .tag{
      font-size:12px; color:var(--text);
      padding:8px 10px; border-radius:999px;
      border:1px solid var(--line);
      background: #f8fafc;
      white-space:nowrap;
    }
    .item .actions{display:flex; gap:8px; align-items:center}

    .kbd{
      border:1px solid var(--line);
      padding:2px 6px; border-radius:6px;
      background: #ffffff;
      color:var(--text);
    }

    .badge-admin{
      display:inline-flex; gap:8px; align-items:center;
      padding:8px 10px; border-radius:999px;
      border:1px solid rgba(22,163,74,.35);
      background: rgba(22,163,74,.10);
      color: var(--text);
      font-size:12px;
    }

    .footer{max-width:1200px; margin:0 auto; padding:0 16px 24px; color:var(--muted); font-size:12px;}
    .note{color:var(--muted); font-size:12px; line-height:1.4}
    .row{display:grid; grid-template-columns: 1fr 1fr; gap:10px}
    @media (max-width: 720px){ .row{grid-template-columns:1fr} }

    .modal-backdrop{
      position:fixed; inset:0; background: rgba(15,23,42,.35);
      display:none; align-items:center; justify-content:center; padding:16px; z-index:1000;
    }
    .modal{
      width:min(740px, 100%);
      background: #ffffff;
      border:1px solid var(--line);
      border-radius:18px;
      box-shadow: 0 24px 80px rgba(15, 23, 42, .22);
      overflow:hidden;
    }
    .modal header{
      position:relative; top:auto; backdrop-filter:none;
      background: #fafbff;
      border-bottom:1px solid var(--line);
    }
    .modal .content{padding:14px}
    .modal .footerbar{
      display:flex; justify-content:space-between; gap:10px; padding:12px 14px;
      border-top:1px solid var(--line);
      background: #fafbff;
      flex-wrap:wrap;
      align-items:center;
    }

    @media print{
      .adminOnly, .toolbar, .chips, .badge-admin, .modal-backdrop {display:none !important}
      body{background:#fff; color:#000}
      .card{box-shadow:none; background:#fff; border:1px solid #ddd}
      .day, .item{background:#fff}
    }
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="title">
      <div>
        <h1>2026í•™ë…„ë„ í•™ì‚¬ì¼ì •</h1>
        <p class="sub">ì›”ë³„ ìº˜ë¦°ë” + ì¼ì • ë¦¬ìŠ¤íŠ¸ Â· ê²€ìƒ‰/í•„í„° Â· ê´€ë¦¬ì í¸ì§‘</p>
      </div>
      <div class="controls">
        <span id="adminBadge" class="badge-admin" style="display:none;">ğŸ›¡ ê´€ë¦¬ì ëª¨ë“œ</span>
        <button class="btn small" id="loginBtn">ğŸ”’ ê´€ë¦¬ì ë¡œê·¸ì¸</button>
        <button class="btn small bad" id="logoutBtn" style="display:none;">ë¡œê·¸ì•„ì›ƒ</button>
        <button class="btn small" id="pwChangeOpenBtn" style="display:none;">ğŸ” ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
      </div>
    </div>

    <div class="toolbar">
      <div class="controls">
        <button class="btn small" id="prevBtn" title="ì´ì „ ë‹¬ (â†)">â—€ï¸ <span>ì´ì „</span></button>
        <button class="btn small" id="startBtn" title="í•™ë…„ë„ ì‹œì‘(2026-03)">â— <span>2026 ì‹œì‘</span></button>
        <button class="btn small" id="nextBtn" title="ë‹¤ìŒ ë‹¬ (â†’)"><span>ë‹¤ìŒ</span> â–¶ï¸</button>

        <select id="monthSelect" title="ì›” ì„ íƒ"></select>

        <select id="catSelect" title="ë¶„ë¥˜ í•„í„°">
          <option value="ALL">ì „ì²´ ë¶„ë¥˜</option>
        </select>

        <input id="q" class="input" placeholder="ê²€ìƒ‰: ì˜ˆ) ìˆ˜ê°•, ì¤‘ê°„, ì¢…ê°•, íœ´ê°•â€¦" />
      </div>

      <div class="controls">
        <button class="btn adminOnly good" id="addBtn" style="display:none;">ï¼‹ ì¼ì • ì¶”ê°€</button>
        <button class="btn" id="exportBtn" title="í˜„ì¬ í•„í„° ê²°ê³¼ë¥¼ CSVë¡œ ì €ì¥">â¤“ CSV</button>
        <button class="btn primary" id="printBtn" title="ì¸ì‡„/ì €ì¥ (Ctrl+P)">ğŸ–¨ ì¸ì‡„</button>
      </div>
    </div>
  </div>
</header>

<main>
  <div class="wrap">
    <div class="grid">
      <section class="card" id="monthCard">
        <div class="monthbar">
          <div class="m" id="monthTitle">2026.03</div>
          <div style="color:var(--muted); font-size:12px;">
            ë‹¨ì¶•í‚¤: <span class="kbd">â†</span> <span class="kbd">â†’</span>
          </div>
        </div>
        <div class="chips" id="summaryChips"></div>
        <div class="calendar">
          <div class="cal-head" id="dow"></div>
          <div class="cal-grid" id="cal"></div>
        </div>
      </section>

      <aside class="card" id="sideCard">
        <h2>ì„ íƒ ì›” ì¼ì •</h2>
        <p class="hint">í˜„ì¬ ì›” + í•„í„°/ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” ì¼ì •ë§Œ í‘œì‹œë©ë‹ˆë‹¤.</p>
        <div class="list" id="list"></div>
      </aside>
    </div>
  </div>
</main>

<div class="footer">
  <div class="wrap">
    <div>â€» ë³€ê²½ ë‚´ìš©ì€ <b>ì´ ë¸Œë¼ìš°ì €(LocalStorage)</b>ì— ì €ì¥ë©ë‹ˆë‹¤.</div>
    <div class="note">ì—¬ëŸ¬ ì‚¬ëŒì´ í•¨ê»˜ ì“°ê±°ë‚˜ ë‹¤ë¥¸ PC/íœ´ëŒ€í°ì—ì„œë„ ë™ì¼í•˜ê²Œ ë³´ì´ê²Œ í•˜ë ¤ë©´ ì„œë²„/DBê°€ í•„ìš”í•©ë‹ˆë‹¤.</div>
  </div>
</div>

<!-- ë¡œê·¸ì¸ ëª¨ë‹¬ -->
<div class="modal-backdrop" id="loginModal">
  <div class="modal">
    <header>
      <div class="monthbar">
        <div class="m">ê´€ë¦¬ì ë¡œê·¸ì¸</div>
        <button class="btn small" onclick="UI.closeModal('loginModal')">âœ• ë‹«ê¸°</button>
      </div>
    </header>
    <div class="content">
      <div>
        <div style="margin-bottom:8px; color:var(--muted); font-size:12px;">ë¹„ë°€ë²ˆí˜¸</div>
        <!-- ê¸°ë³¸ ë¹„ë°€ë²ˆí˜¸ ë¬¸êµ¬/ë…¸ì¶œ ì—†ìŒ -->
        <input id="pwInput" class="input" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" autocomplete="current-password" />
      </div>

      <div style="margin-top:10px; display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
        <div class="note">ë¡œê·¸ì¸ì´ í•„ìš”í•œ ê¸°ëŠ¥: ì¼ì • ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ</div>
        <button class="btn link" id="forgotBtn" type="button">ë¹„ë°€ë²ˆí˜¸ë¥¼ ìŠì–´ë²„ë¦¬ì…¨ë‚˜ìš”?</button>
      </div>

      <div class="note" style="margin-top:10px;">
        â€¢ ì„œë²„ ì—†ëŠ” ë‹¨ì¼ íŒŒì¼ì´ë¼ ë¸Œë¼ìš°ì € ì €ì¥ ë¹„ë°€ë²ˆí˜¸ë¡œ ë³´í˜¸ë©ë‹ˆë‹¤.<br/>
        â€¢ ë³´ì•ˆì´ ì¤‘ìš”í•˜ë©´ ì„œë²„ ë¡œê·¸ì¸ ë°©ì‹ìœ¼ë¡œ ì „í™˜ ê¶Œì¥.
      </div>
    </div>

    <div class="footerbar">
      <!-- ê´€ë¦¬ì ë¡œê·¸ì¸ í›„ì—ë§Œ í‘œì‹œ (ìš”êµ¬ì‚¬í•­ ìœ ì§€) -->
      <button class="btn bad" id="resetBtn" style="display:none;" onclick="DATA.resetAll()">ì´ˆê¸°í™”(ì „ì²´ ì‚­ì œ)</button>

      <div style="display:flex; gap:10px; flex-wrap:wrap;">
        <button class="btn" onclick="UI.closeModal('loginModal')">ì·¨ì†Œ</button>
        <button class="btn primary" id="doLoginBtn">ë¡œê·¸ì¸</button>
      </div>
    </div>
  </div>
</div>

<!-- ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°/ì¬ì„¤ì • ëª¨ë‹¬ -->
<div class="modal-backdrop" id="recoverModal">
  <div class="modal">
    <header>
      <div class="monthbar">
        <div class="m">ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •</div>
        <button class="btn small" onclick="UI.closeModal('recoverModal')">âœ• ë‹«ê¸°</button>
      </div>
    </header>

    <div class="content">
      <div>
        <div style="margin-bottom:8px; color:var(--muted); font-size:12px;">ì§ˆë¬¸</div>
        <div style="font-weight:700; margin-bottom:10px;">1í•™ë…„ë•Œ í•™ë²ˆì€ ë­ëƒ?</div>
        <input id="recoverAnswer" class="input" inputmode="numeric" placeholder="í•™ë²ˆ ì…ë ¥" />
        <div class="note" style="margin-top:8px;">ì •ë‹µì„ ì…ë ¥í•˜ë©´ ì•„ë˜ì—ì„œ ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
      </div>

      <div id="recoverFields" style="display:none; margin-top:14px;">
        <div class="row">
          <div>
            <div style="margin-bottom:8px; color:var(--muted); font-size:12px;">ìƒˆ ë¹„ë°€ë²ˆí˜¸</div>
            <input id="recoverNewPw" class="input" type="password" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" autocomplete="new-password" />
          </div>
          <div>
            <div style="margin-bottom:8px; color:var(--muted); font-size:12px;">ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸</div>
            <input id="recoverNewPw2" class="input" type="password" placeholder="í•œ ë²ˆ ë” ì…ë ¥" autocomplete="new-password" />
          </div>
        </div>
        <div class="note" style="margin-top:10px;">
          â€¢ ì¬ì„¤ì • í›„ì—ëŠ” ë‹¤ì‹œ ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”.
        </div>
      </div>
    </div>

    <div class="footerbar">
      <button class="btn" onclick="UI.closeModal('recoverModal')">ì·¨ì†Œ</button>
      <div style="display:flex; gap:10px; flex-wrap:wrap;">
        <button class="btn" id="recoverCheckBtn">ì •ë‹µ í™•ì¸</button>
        <button class="btn primary" id="recoverSaveBtn" style="display:none;">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
      </div>
    </div>
  </div>
</div>

<!-- ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ëª¨ë‹¬ (ê´€ë¦¬ì ë¡œê·¸ì¸ í›„ì—ë§Œ ì—´ë¦¼) -->
<div class="modal-backdrop" id="pwModal">
  <div class="modal">
    <header>
      <div class="monthbar">
        <div class="m">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</div>
        <button class="btn small" onclick="UI.closeModal('pwModal')">âœ• ë‹«ê¸°</button>
      </div>
    </header>
    <div class="content">
      <div class="row">
        <div>
          <div style="margin-bottom:8px; color:var(--muted); font-size:12px;">í˜„ì¬ ë¹„ë°€ë²ˆí˜¸</div>
          <input id="pwCur2" class="input" type="password" placeholder="í˜„ì¬ ë¹„ë°€ë²ˆí˜¸" autocomplete="current-password" />
        </div>
        <div>
          <div style="margin-bottom:8px; color:var(--muted); font-size:12px;">ìƒˆ ë¹„ë°€ë²ˆí˜¸</div>
          <input id="pwNew2" class="input" type="password" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸" autocomplete="new-password" />
        </div>
      </div>
      <div class="note" style="margin-top:10px;">
        â€¢ ë³€ê²½ ì¦‰ì‹œ ì´ ë¸Œë¼ìš°ì €ì— ì €ì¥ë©ë‹ˆë‹¤.
      </div>
    </div>
    <div class="footerbar">
      <button class="btn" onclick="UI.closeModal('pwModal')">ì·¨ì†Œ</button>
      <button class="btn primary" id="pwSaveBtn">ë³€ê²½ ì €ì¥</button>
    </div>
  </div>
</div>

<!-- ì¼ì • í¸ì§‘/ì¶”ê°€ ëª¨ë‹¬ -->
<div class="modal-backdrop" id="editModal">
  <div class="modal">
    <header>
      <div class="monthbar">
        <div class="m" id="editTitle">ì¼ì • ì¶”ê°€</div>
        <button class="btn small" onclick="UI.closeModal('editModal')">âœ• ë‹«ê¸°</button>
      </div>
    </header>
    <div class="content">
      <div class="row">
        <div>
          <div style="margin-bottom:8px; color:var(--muted); font-size:12px;">ë‚ ì§œ</div>
          <input id="fDate" class="input" type="date" />
        </div>
        <div>
          <div style="margin-bottom:8px; color:var(--muted); font-size:12px;">ë¶„ë¥˜</div>
          <select id="fCat" class="input"></select>
        </div>
      </div>
      <div style="margin-top:10px;">
        <div style="margin-bottom:8px; color:var(--muted); font-size:12px;">ì¼ì •ëª…</div>
        <input id="fTitle" class="input" placeholder="ì˜ˆ: 1í•™ê¸° ê°œê°•" />
      </div>
      <div style="margin-top:10px;">
        <div style="margin-bottom:8px; color:var(--muted); font-size:12px;">ì„¤ëª…(ì„ íƒ)</div>
        <textarea id="fNote" class="input" placeholder="ì˜ˆ: ìˆ˜ê°•ì‹ ì²­ ì •ì • ê¸°ê°„ / ì„¸ë¶€ ì•ˆë‚´ ë§í¬ ë“±"></textarea>
      </div>
      <input type="hidden" id="fId" />
    </div>
    <div class="footerbar">
      <button class="btn bad" id="deleteBtn" style="display:none;">ì‚­ì œ</button>
      <div style="display:flex; gap:10px; flex-wrap:wrap;">
        <button class="btn" onclick="UI.closeModal('editModal')">ì·¨ì†Œ</button>
        <button class="btn good" id="saveBtn">ì €ì¥</button>
      </div>
    </div>
  </div>
</div>

<script>
/** ==========================================================
 *  ì €ì¥ì†Œ í‚¤
 * ========================================================== */
const LS = {
  EVENTS: "acad_2026_events_v1",
  ADMIN_PW: "acad_2026_admin_pw_v1",
  ADMIN_ON: "acad_2026_admin_on_v1",
  CATS: "acad_2026_categories_v1",
};

/** ==========================================================
 *  ê¸°ë³¸ ë°ì´í„° (ì²˜ìŒ ì‹¤í–‰ ì‹œë§Œ ì‚¬ìš©)
 * ========================================================== */
const DEFAULT_CATEGORIES = ["í•™ì‚¬","ìˆ˜ì—…","ì‹œí—˜","íœ´ì¼"];
const DEFAULT_EVENTS = [
  { id: crypto.randomUUID(), date:"2026-03-02", title:"1í•™ê¸° ê°œê°•(ì˜ˆì‹œ)", category:"í•™ì‚¬", note:"í•™êµ ê³µì§€ ê¸°ì¤€ìœ¼ë¡œ ìˆ˜ì •" },
  { id: crypto.randomUUID(), date:"2026-03-02", title:"ìˆ˜ê°•ì‹ ì²­ ì •ì •/ë³€ê²½(ì˜ˆì‹œ)", category:"í•™ì‚¬", note:"ê¸°ê°„/ë°©ì‹ì€ í•™êµë³„ ìƒì´" },
  { id: crypto.randomUUID(), date:"2026-04-20", title:"ì¤‘ê°„ê³ ì‚¬(ì˜ˆì‹œ)", category:"ì‹œí—˜", note:"ê¸°ê°„/ì£¼ê°„ìœ¼ë¡œ ì…ë ¥ ê°€ëŠ¥" },
  { id: crypto.randomUUID(), date:"2026-06-15", title:"ê¸°ë§ê³ ì‚¬(ì˜ˆì‹œ)", category:"ì‹œí—˜", note:"í•™êµë³„ ì¼ì • ìƒì´" },
  { id: crypto.randomUUID(), date:"2026-06-26", title:"1í•™ê¸° ì¢…ê°•(ì˜ˆì‹œ)", category:"í•™ì‚¬" },
  { id: crypto.randomUUID(), date:"2026-09-01", title:"2í•™ê¸° ê°œê°•(ì˜ˆì‹œ)", category:"í•™ì‚¬" },
  { id: crypto.randomUUID(), date:"2026-10-19", title:"ì¤‘ê°„ê³ ì‚¬(ì˜ˆì‹œ)", category:"ì‹œí—˜" },
  { id: crypto.randomUUID(), date:"2026-12-14", title:"ê¸°ë§ê³ ì‚¬(ì˜ˆì‹œ)", category:"ì‹œí—˜" },
  { id: crypto.randomUUID(), date:"2026-12-23", title:"2í•™ê¸° ì¢…ê°•(ì˜ˆì‹œ)", category:"í•™ì‚¬" },
  { id: crypto.randomUUID(), date:"2026-05-05", title:"ì–´ë¦°ì´ë‚ (ì˜ˆì‹œ)", category:"íœ´ì¼" },
];

const START_MONTH = "2026-03-01";
const END_MONTH   = "2027-02-01";

/** ìš”êµ¬ì‚¬í•­: ê¸°ë³¸ ë¹„ë°€ë²ˆí˜¸ */
const DEFAULT_ADMIN_PW = "120725";

/** ìš”êµ¬ì‚¬í•­: ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° ì •ë‹µ */
const RECOVERY_ANSWER = "10929";

/** ==========================================================
 *  DATA ëª¨ë“ˆ (LocalStorage CRUD)
 * ========================================================== */
const DATA = {
  init(){
    if(!localStorage.getItem(LS.CATS)){
      localStorage.setItem(LS.CATS, JSON.stringify(DEFAULT_CATEGORIES));
    }
    if(!localStorage.getItem(LS.EVENTS)){
      localStorage.setItem(LS.EVENTS, JSON.stringify(DEFAULT_EVENTS));
    }
    // ê¸°ë³¸ ë¹„ë°€ë²ˆí˜¸ë¥¼ 120725ë¡œ ì„¤ì • (ìµœì´ˆ 1íšŒ)
    if(!localStorage.getItem(LS.ADMIN_PW)){
      localStorage.setItem(LS.ADMIN_PW, this.hash(DEFAULT_ADMIN_PW));
    }
    if(!localStorage.getItem(LS.ADMIN_ON)){
      localStorage.setItem(LS.ADMIN_ON, "0");
    }
  },
  getCategories(){
    return JSON.parse(localStorage.getItem(LS.CATS) || "[]");
  },
  getEvents(){
    return JSON.parse(localStorage.getItem(LS.EVENTS) || "[]");
  },
  setEvents(events){
    localStorage.setItem(LS.EVENTS, JSON.stringify(events));
  },
  isAdmin(){
    return localStorage.getItem(LS.ADMIN_ON)==="1";
  },
  setAdmin(on){
    localStorage.setItem(LS.ADMIN_ON, on ? "1":"0");
  },
  hash(s){
    // ë‹¨ì¼ íŒŒì¼ìš© ê°„ë‹¨ í•´ì‹œ(ë³´ì•ˆ ê°•ë„ ëª©ì  ì•„ë‹˜)
    let h = 2166136261;
    for(let i=0;i<s.length;i++){
      h ^= s.charCodeAt(i);
      h = Math.imul(h, 16777619);
    }
    return (h>>>0).toString(16);
  },
  verifyPw(pw){
    const saved = localStorage.getItem(LS.ADMIN_PW) || "";
    return saved === this.hash(pw);
  },
  setPw(newPw){
    localStorage.setItem(LS.ADMIN_PW, this.hash(newPw));
  },
  upsertEvent(ev){
    const list = this.getEvents();
    const idx = list.findIndex(x=>x.id===ev.id);
    if(idx>=0) list[idx]=ev; else list.push(ev);
    this.setEvents(list);
  },
  deleteEvent(id){
    const list = this.getEvents().filter(x=>x.id!==id);
    this.setEvents(list);
  },
  resetAll(){
    if(!DATA.isAdmin()){
      alert("ê´€ë¦¬ì ë¡œê·¸ì¸ í›„ì—ë§Œ ì´ˆê¸°í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
      return;
    }
    if(!confirm("ì •ë§ ì´ˆê¸°í™”í• ê¹Œìš”? (ëª¨ë“  ì¼ì •/ë¹„ë²ˆ í¬í•¨)")) return;
    localStorage.removeItem(LS.EVENTS);
    localStorage.removeItem(LS.ADMIN_PW);
    localStorage.removeItem(LS.ADMIN_ON);
    localStorage.removeItem(LS.CATS);
    location.reload();
  }
};

/** ==========================================================
 *  UI ë Œë”
 * ========================================================== */
const DOW = ["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "];

let state = {
  cursor: new Date(START_MONTH),
  cat: "ALL",
  q: "",
};

const els = {
  monthTitle: document.getElementById("monthTitle"),
  dow: document.getElementById("dow"),
  cal: document.getElementById("cal"),
  list: document.getElementById("list"),
  monthSelect: document.getElementById("monthSelect"),
  catSelect: document.getElementById("catSelect"),
  q: document.getElementById("q"),
  summaryChips: document.getElementById("summaryChips"),

  loginBtn: document.getElementById("loginBtn"),
  logoutBtn: document.getElementById("logoutBtn"),
  adminBadge: document.getElementById("adminBadge"),
  addBtn: document.getElementById("addBtn"),
  exportBtn: document.getElementById("exportBtn"),
  printBtn: document.getElementById("printBtn"),
  prevBtn: document.getElementById("prevBtn"),
  nextBtn: document.getElementById("nextBtn"),
  startBtn: document.getElementById("startBtn"),

  loginModal: document.getElementById("loginModal"),
  pwInput: document.getElementById("pwInput"),
  doLoginBtn: document.getElementById("doLoginBtn"),
  resetBtn: document.getElementById("resetBtn"),
  forgotBtn: document.getElementById("forgotBtn"),

  recoverModal: document.getElementById("recoverModal"),
  recoverAnswer: document.getElementById("recoverAnswer"),
  recoverFields: document.getElementById("recoverFields"),
  recoverNewPw: document.getElementById("recoverNewPw"),
  recoverNewPw2: document.getElementById("recoverNewPw2"),
  recoverCheckBtn: document.getElementById("recoverCheckBtn"),
  recoverSaveBtn: document.getElementById("recoverSaveBtn"),

  pwChangeOpenBtn: document.getElementById("pwChangeOpenBtn"),
  pwModal: document.getElementById("pwModal"),
  pwCur2: document.getElementById("pwCur2"),
  pwNew2: document.getElementById("pwNew2"),
  pwSaveBtn: document.getElementById("pwSaveBtn"),

  editModal: document.getElementById("editModal"),
  editTitle: document.getElementById("editTitle"),
  fId: document.getElementById("fId"),
  fDate: document.getElementById("fDate"),
  fCat: document.getElementById("fCat"),
  fTitle: document.getElementById("fTitle"),
  fNote: document.getElementById("fNote"),
  saveBtn: document.getElementById("saveBtn"),
  deleteBtn: document.getElementById("deleteBtn"),
};

function pad2(n){ return String(n).padStart(2,"0"); }
function toISODate(d){
  const y=d.getFullYear(), m=pad2(d.getMonth()+1), day=pad2(d.getDate());
  return `${y}-${m}-${day}`;
}
function ymKey(d){ return `${d.getFullYear()}-${pad2(d.getMonth()+1)}`; }
function formatYM(d){ return `${d.getFullYear()}.${pad2(d.getMonth()+1)}`; }
function formatDateK(iso){
  const [y,m,d]=iso.split("-").map(Number);
  return `${y}.${pad2(m)}.${pad2(d)}`;
}
function normalized(s){ return (s||"").toLowerCase().trim(); }
function escapeHtml(s){
  return String(s||"").replace(/[&<>"']/g, (m)=>({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
  })[m]);
}
function clampCursor(){
  const min = new Date(START_MONTH);
  const max = new Date(END_MONTH);
  if(state.cursor < min) state.cursor = min;
  if(state.cursor > max) state.cursor = max;
}

function getFilteredEvents(){
  const q = normalized(state.q);
  const all = DATA.getEvents().slice().sort((a,b)=>a.date.localeCompare(b.date));
  return all
    .filter(e => state.cat==="ALL" ? true : e.category===state.cat)
    .filter(e => {
      if(!q) return true;
      return normalized(e.title).includes(q) || normalized(e.note).includes(q) || normalized(e.category).includes(q) || e.date.includes(q);
    });
}
function eventsInMonth(monthDate){
  const key = ymKey(monthDate);
  return getFilteredEvents().filter(e => e.date.startsWith(key));
}
function colorClass(cat){ return `cat-${cat}`; }

function buildMonthOptions(){
  const start = new Date(START_MONTH);
  const end = new Date(END_MONTH);
  const opts = [];
  const d = new Date(start);
  d.setDate(1);
  while(d <= end){
    opts.push({ value: ymKey(d), label: formatYM(d) });
    d.setMonth(d.getMonth()+1);
  }
  els.monthSelect.innerHTML = opts.map(o => `<option value="${o.value}">${o.label}</option>`).join("");
}
function buildCategoryOptions(){
  const cats = DATA.getCategories();
  els.catSelect.innerHTML = `<option value="ALL">ì „ì²´ ë¶„ë¥˜</option>` + cats.map(c=>`<option value="${c}">${c}</option>`).join("");
  els.fCat.innerHTML = cats.map(c=>`<option value="${c}">${c}</option>`).join("");
}

function renderDOW(){
  els.dow.innerHTML = DOW.map(x=>`<div>${x}</div>`).join("");
}

function renderSummaryChips(monthEvents){
  const byCat = {};
  for(const e of monthEvents){
    byCat[e.category] = (byCat[e.category]||0)+1;
  }
  const cats = Object.keys(byCat).sort((a,b)=>a.localeCompare(b,"ko"));
  const total = monthEvents.length;

  const makeChip = (label, count, active, value) => `
    <div class="chip ${active?'active':''}" data-cat="${escapeHtml(value)}">
      <b>${escapeHtml(label)}</b> ${count}ê±´
    </div>
  `;
  const chips = [];
  chips.push(makeChip("ì „ì²´", total, state.cat==="ALL", "ALL"));
  for(const c of cats){
    chips.push(makeChip(c, byCat[c], state.cat===c, c));
  }
  els.summaryChips.innerHTML = chips.join("");
  els.summaryChips.querySelectorAll(".chip").forEach(ch => {
    ch.addEventListener("click", () => {
      state.cat = ch.dataset.cat;
      els.catSelect.value = state.cat;
      render();
    });
  });
}

function renderCalendar(){
  clampCursor();
  const cur = new Date(state.cursor);
  cur.setDate(1);
  els.monthTitle.textContent = formatYM(cur);

  const monthEvents = eventsInMonth(cur);
  renderSummaryChips(monthEvents);

  const firstDay = new Date(cur);
  const startDow = firstDay.getDay();
  const startCell = new Date(firstDay);
  startCell.setDate(startCell.getDate() - startDow);

  const cells = [];
  for(let i=0;i<42;i++){
    const d = new Date(startCell);
    d.setDate(startCell.getDate()+i);
    const iso = toISODate(d);
    const inMonth = d.getMonth()===cur.getMonth();
    const dayEvents = monthEvents.filter(e => e.date===iso);

    const pills = dayEvents.slice(0,3).map(e => `
      <div class="pill ${colorClass(e.category)}" title="${escapeHtml(e.title)}${e.note ? ' - '+escapeHtml(e.note) : ''}">
        <span class="dot"></span>
        <span style="min-width:0; overflow:hidden; text-overflow:ellipsis;">${escapeHtml(e.title)}</span>
      </div>
    `).join("");

    const more = dayEvents.length>3 ? `<div class="pill" style="opacity:.75;">+${dayEvents.length-3} ë”ë³´ê¸°</div>` : "";

    cells.push(`
      <div class="day ${inMonth ? "" : "muted"}" data-date="${iso}">
        <div class="dnum"><span>${d.getDate()}</span><span style="color:${dayEvents.length? 'var(--text)':'var(--muted)'}">${dayEvents.length? dayEvents.length+'ê±´':''}</span></div>
        ${pills}${more}
      </div>
    `);
  }
  els.cal.innerHTML = cells.join("");

  els.cal.querySelectorAll(".day").forEach(dayEl => {
    dayEl.addEventListener("click", () => {
      const iso = dayEl.dataset.date;
      if(DATA.isAdmin()){
        UI.openEdit({ id:"", date:iso, title:"", category:DATA.getCategories()[0] || "í•™ì‚¬", note:"" }, true);
      }else{
        const target = document.querySelector(`[data-item-date="${iso}"]`);
        if(target) target.scrollIntoView({behavior:"smooth", block:"center"});
      }
    });
  });

  els.monthSelect.value = ymKey(cur);
}

function renderSideList(){
  const cur = new Date(state.cursor);
  cur.setDate(1);
  const monthEvents = eventsInMonth(cur);

  if(monthEvents.length===0){
    els.list.innerHTML = `<div style="color:var(--muted); padding:10px 2px;">í‘œì‹œí•  ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤. (í•„í„°/ê²€ìƒ‰ ì¡°ê±´ í™•ì¸)</div>`;
    return;
  }

  const admin = DATA.isAdmin();

  els.list.innerHTML = monthEvents.map(e => `
    <div class="item" data-item-date="${escapeHtml(e.date)}">
      <div class="left">
        <div class="date">${formatDateK(e.date)} Â· ${escapeHtml(e.title)}</div>
        <div class="meta">${escapeHtml(e.note || "")}</div>
      </div>
      <div class="actions">
        <div class="tag">${escapeHtml(e.category)}</div>
        ${admin ? `<button class="btn small adminOnly" data-edit="${escapeHtml(e.id)}">ìˆ˜ì •</button>` : ``}
      </div>
    </div>
  `).join("");

  if(admin){
    els.list.querySelectorAll("[data-edit]").forEach(btn=>{
      btn.addEventListener("click", (ev)=>{
        ev.stopPropagation();
        const id = btn.dataset.edit;
        const item = DATA.getEvents().find(x=>x.id===id);
        if(item) UI.openEdit(item, false);
      });
    });
  }
}

function updateAdminUI(){
  const on = DATA.isAdmin();
  els.adminBadge.style.display = on ? "" : "none";
  els.loginBtn.style.display = on ? "none" : "";
  els.logoutBtn.style.display = on ? "" : "none";
  els.addBtn.style.display = on ? "" : "none";

  // ì „ì²´ ì‚­ì œ ë²„íŠ¼: ê´€ë¦¬ì ë¡œê·¸ì¸ í›„ì—ë§Œ í‘œì‹œ
  if(els.resetBtn) els.resetBtn.style.display = on ? "" : "none";

  // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ë²„íŠ¼: ê´€ë¦¬ì ë¡œê·¸ì¸ í›„ì—ë§Œ í‘œì‹œ
  els.pwChangeOpenBtn.style.display = on ? "" : "none";
}

function render(){
  buildCategoryOptions();
  updateAdminUI();
  renderCalendar();
  renderSideList();
}

function moveMonth(delta){
  const d = new Date(state.cursor);
  d.setMonth(d.getMonth()+delta);
  d.setDate(1);
  state.cursor = d;
  clampCursor();
  render();
}

function exportCSV(){
  const rows = [["date","category","title","note"]];
  const data = getFilteredEvents();
  for(const e of data){
    rows.push([e.date, e.category, e.title, e.note||""]);
  }
  const csv = rows.map(r => r.map(v => `"${String(v).replace(/"/g,'""')}"`).join(",")).join("\n");
  const blob = new Blob([csv], {type:"text/csv;charset=utf-8;"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = `academic_calendar_2026_filtered.csv`;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

/** ==========================================================
 *  ëª¨ë‹¬ / í¸ì§‘
 * ========================================================== */
const UI = {
  openModal(id){ document.getElementById(id).style.display="flex"; },
  closeModal(id){ document.getElementById(id).style.display="none"; },

  openLogin(){
    els.pwInput.value="";
    this.openModal("loginModal");
    setTimeout(()=>els.pwInput.focus(), 30);
  },

  openRecover(){
    // reset UI state
    els.recoverAnswer.value="";
    els.recoverFields.style.display="none";
    els.recoverSaveBtn.style.display="none";
    els.recoverNewPw.value="";
    els.recoverNewPw2.value="";
    this.openModal("recoverModal");
    setTimeout(()=>els.recoverAnswer.focus(), 30);
  },

  openPwChange(){
    if(!DATA.isAdmin()){
      alert("ê´€ë¦¬ì ë¡œê·¸ì¸ í›„ì—ë§Œ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
      return;
    }
    els.pwCur2.value="";
    els.pwNew2.value="";
    this.openModal("pwModal");
    setTimeout(()=>els.pwCur2.focus(), 30);
  },

  openEdit(ev, isNew){
    if(!DATA.isAdmin()) return;

    els.editTitle.textContent = isNew ? "ì¼ì • ì¶”ê°€" : "ì¼ì • ìˆ˜ì •";
    els.fId.value = ev.id || "";
    els.fDate.value = ev.date || "";
    els.fCat.value = ev.category || (DATA.getCategories()[0] || "í•™ì‚¬");
    els.fTitle.value = ev.title || "";
    els.fNote.value = ev.note || "";

    els.deleteBtn.style.display = isNew ? "none" : "";
    this.openModal("editModal");
    setTimeout(()=>els.fTitle.focus(), 30);

    els.deleteBtn.onclick = () => {
      if(!confirm("ì •ë§ ì‚­ì œí• ê¹Œìš”?")) return;
      DATA.deleteEvent(ev.id);
      this.closeModal("editModal");
      render();
    };
  }
};

/** ==========================================================
 *  ë°”ì¸ë”©
 * ========================================================== */
DATA.init();
buildMonthOptions();
renderDOW();

els.prevBtn.addEventListener("click", ()=>moveMonth(-1));
els.nextBtn.addEventListener("click", ()=>moveMonth(+1));
els.startBtn.addEventListener("click", ()=>{ state.cursor = new Date(START_MONTH); render(); });

els.monthSelect.addEventListener("change", (e)=>{
  const [y,m] = e.target.value.split("-").map(Number);
  state.cursor = new Date(y, m-1, 1);
  render();
});
els.catSelect.addEventListener("change", (e)=>{ state.cat = e.target.value; render(); });
els.q.addEventListener("input", (e)=>{ state.q = e.target.value; render(); });

els.exportBtn.addEventListener("click", exportCSV);
els.printBtn.addEventListener("click", ()=>window.print());

els.loginBtn.addEventListener("click", ()=>UI.openLogin());
els.logoutBtn.addEventListener("click", ()=>{
  DATA.setAdmin(false);
  render();
});

els.doLoginBtn.addEventListener("click", ()=>{
  const pw = els.pwInput.value || "";
  if(!DATA.verifyPw(pw)){
    alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
    return;
  }
  DATA.setAdmin(true);
  UI.closeModal("loginModal");
  render();
});

els.forgotBtn.addEventListener("click", ()=>{
  UI.closeModal("loginModal");
  UI.openRecover();
});

els.recoverCheckBtn.addEventListener("click", ()=>{
  const ans = (els.recoverAnswer.value || "").trim();
  if(ans !== RECOVERY_ANSWER){
    alert("ì •ë‹µì´ ì•„ë‹™ë‹ˆë‹¤.");
    els.recoverFields.style.display = "none";
    els.recoverSaveBtn.style.display = "none";
    return;
  }
  els.recoverFields.style.display = "";
  els.recoverSaveBtn.style.display = "";
  els.recoverNewPw.focus();
});

els.recoverSaveBtn.addEventListener("click", ()=>{
  const ans = (els.recoverAnswer.value || "").trim();
  if(ans !== RECOVERY_ANSWER){
    alert("ì •ë‹µ í™•ì¸ì„ ë¨¼ì € í•´ì£¼ì„¸ìš”.");
    return;
  }
  const npw1 = (els.recoverNewPw.value || "").trim();
  const npw2 = (els.recoverNewPw2.value || "").trim();

  if(npw1.length < 4){
    alert("ìƒˆ ë¹„ë°€ë²ˆí˜¸ëŠ” 4ì ì´ìƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.");
    return;
  }
  if(npw1 !== npw2){
    alert("ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
    return;
  }

  DATA.setPw(npw1);
  DATA.setAdmin(false); // ì¬ì„¤ì • í›„ì—ëŠ” ë‹¤ì‹œ ë¡œê·¸ì¸í•˜ë„ë¡
  UI.closeModal("recoverModal");
  alert("ë¹„ë°€ë²ˆí˜¸ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”.");
  render();
});

els.pwChangeOpenBtn.addEventListener("click", ()=>UI.openPwChange());

els.pwSaveBtn.addEventListener("click", ()=>{
  if(!DATA.isAdmin()){
    alert("ê´€ë¦¬ì ë¡œê·¸ì¸ í›„ì—ë§Œ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
    return;
  }
  const cur = els.pwCur2.value || "";
  const nw = (els.pwNew2.value || "").trim();

  if(!DATA.verifyPw(cur)){
    alert("í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
    return;
  }
  if(nw.length < 4){
    alert("ìƒˆ ë¹„ë°€ë²ˆí˜¸ëŠ” 4ì ì´ìƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.");
    return;
  }
  DATA.setPw(nw);
  UI.closeModal("pwModal");
  alert("ë¹„ë°€ë²ˆí˜¸ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.");
});

els.addBtn.addEventListener("click", ()=>{
  const date = toISODate(new Date(state.cursor.getFullYear(), state.cursor.getMonth(), 1));
  UI.openEdit({ id:"", date, title:"", category: DATA.getCategories()[0] || "í•™ì‚¬", note:"" }, true);
});

els.saveBtn.addEventListener("click", ()=>{
  if(!DATA.isAdmin()) return;

  const id = els.fId.value || crypto.randomUUID();
  const date = els.fDate.value;
  const category = els.fCat.value;
  const title = els.fTitle.value.trim();
  const note = els.fNote.value.trim();

  if(!date){ alert("ë‚ ì§œë¥¼ ì…ë ¥í•˜ì„¸ìš”."); return; }
  if(!title){ alert("ì¼ì •ëª…ì„ ì…ë ¥í•˜ì„¸ìš”."); return; }

  DATA.upsertEvent({ id, date, category, title, note });
  UI.closeModal("editModal");
  render();
});

window.addEventListener("keydown", (e)=>{
  if(els.editModal.style.display==="flex") return;
  if(els.loginModal.style.display==="flex") return;
  if(els.pwModal.style.display==="flex") return;
  if(els.recoverModal.style.display==="flex") return;
  if(e.key==="ArrowLeft") moveMonth(-1);
  if(e.key==="ArrowRight") moveMonth(+1);
});

// ì´ˆê¸° ë Œë”
render();
</script>
</body>
</html>
